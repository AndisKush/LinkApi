(()=>{var e={697:(e,o,n)=>{const t=n(147),a=n(38),s=n(40),E=n(832),r=n(419);async function c(){let e,o=t.readFileSync("./config.json"),n=JSON.parse(o),s=[],E=[];const c=[];let i=[],O=[],l=[];c[0]=new Promise(((e,o)=>{a.executeQuerySL(n," delete from eventos e where e.cod_evento not in (select c.cod_evento from cfgeventos c where c.status = 'true') and e.data = current_date ",s,(async function(o,n){e({})}))})),c[1]=new Promise(((e,o)=>{a.executeQuerySL(n," SELECT * FROM CFGEVENTOS C WHERE C.TIPO = 1 AND C.STATUS = 'true' ORDER BY C.COD_EVENTO ",s,(function(o,n){o?console.log(o):(i=n,e(n))}))})),c[2]=new Promise(((e,o)=>{a.executeQuerySL(n," SELECT * FROM CFGEVENTOS C JOIN CFGALL CF ON 1=1 WHERE C.TIPO = 2 AND C.STATUS = 'true' ORDER BY C.DIAS ",s,(function(o,n){o?console.log(o):(O=n,e(n))}))})),c[3]=new Promise(((e,o)=>{a.executeQuerySL(n," SELECT C.*, CAST(C.SQL AS VARCHAR(2000)) AS SQL FROM CFGEVENTOS C WHERE C.TIPO = 3 AND C.STATUS = 'true' ORDER BY C.COD_EVENTO ",s,(function(o,n){o?console.log(o):(l=n,e(n))}))})),c[4]=new Promise(((e,o)=>{a.executeQuerySL(n," execute procedure del_eve_exce ",s,(async function(o,n){e({})}))})),c[5]=new Promise(((o,t)=>{a.executeQuerySL(n," SELECT * FROM CFGALL ",s,(async function(n,t){n?console.log(n):(e=t[0],o(t))}))})),await Promise.all(c);let T="\n    SELECT DISTINCT 3 as cod_evento \n     , R.RECEBER as COD_RECEBER \n     , C.CLIENTE AS ID_CLIENTE \n     , cast(c.nome as varchar(100) character set ISO8859_1) AS NOME \n     , cast(CI.RAZAO as varchar(100) character set ISO8859_1) AS RAZAOSOCIAL \n     , case when POSITION(' ' in C.NOME) = 0 then cast(c.nome as varchar(100) character set ISO8859_1) else cast(SUBSTRING(C.NOME from 1 for POSITION(' ' in C.NOME)) as varchar(100) character set ISO8859_1) end AS PRIMEIRONOME \n     , (EXTRACT (YEAR FROM CURRENT_DATE) -  EXTRACT ( YEAR FROM CI.NASCIMENTO )) AS IDADE \n     , R.VALOR \n     , R.DTVENC AS VENCIMENTO \n     , R.DTDOC AS DTDOC \n     , R.NUMDOC \n     , (select first(1) b.des_linha_digitavel from boleto b join boletoreceber br on br.blt_id = b.blt_id where br.rcb_id = r.receber) as codigodebarrasboleto \n     , CE.TELEFONE as TELEFONE1 \n     , CE2.TELEFONE as TELEFONE2 \n     , cast(r.historico as varchar(100) character set ISO8859_1) AS historico \n     FROM CLIENTE C \n     LEFT JOIN CLI_ENDE CE ON CE.CLIENTE = C.CLIENTE AND CE.TIPO = 'R' \n     LEFT JOIN CLI_ENDE CE2 ON CE2.CLIENTE = C.CLIENTE AND CE2.TIPO = 'T' \n     LEFT JOIN CLI_COMP CI ON CI.CLIENTE = C.CLIENTE \n     left join receber r on r.cliente = c.cliente \n     LEFT JOIN BOLETORECEBER BR ON BR.RCB_ID = R.RECEBER \n     LEFT JOIN BOLETO B ON B.BLT_ID = BR.BLT_ID \n     WHERE \n     (CE.TIPO = 'R') \n     AND coalesce(c.flg_inativo,'0')='0' \n     AND (R.TIPO = 'R'  OR R.TIPO IS NULL) \n     AND R.DTPGTO IS NULL \n     AND R.VALOR > 0 \n     AND R.dtvenc = CURRENT_DATE + 1 \n    ";e&&1===e.boletosemitidos&&(T+=" AND B.BLT_BOLETO IS NOT NULL ");for await(const e of i.map((e=>new Promise(((o,t)=>{1===e.cod_evento&&a.executeQueryERP(n," \n    SELECT  DISTINCT 1 as cod_evento \n     , C.CLIENTE AS ID_CLIENTE \n     , cast(c.nome as varchar(100) character set ISO8859_1) AS NOME \n     , cast(CI.RAZAO as varchar(100) character set ISO8859_1) AS RAZAOSOCIAL \n     , case when POSITION(' ' in C.NOME) = 0 then cast(c.nome as varchar(100) character set ISO8859_1) else cast(SUBSTRING(C.NOME from 1 for POSITION(' ' in C.NOME)) as varchar(100) character set ISO8859_1) end AS PRIMEIRONOME \n     , (EXTRACT (YEAR FROM CURRENT_DATE) -  EXTRACT ( YEAR FROM CI.NASCIMENTO )) AS IDADE \n     , 0 as VALOR \n     , null AS VENCIMENTO \n     , 0 AS NUMDOC \n     , '' as codigodebarrasboleto \n     , CE.TELEFONE as TELEFONE1 \n     , CE2.TELEFONE as TELEFONE2 \n     FROM CLIENTE C \n     LEFT JOIN CLI_ENDE CE ON CE.CLIENTE = C.CLIENTE AND CE.TIPO = 'R' \n     LEFT JOIN CLI_ENDE CE2 ON CE2.CLIENTE = C.CLIENTE AND CE2.TIPO = 'T' \n     LEFT JOIN CLI_COMP CI ON CI.CLIENTE = C.CLIENTE \n     WHERE \n     (CE.TIPO = 'R') \n     AND coalesce(c.flg_inativo,'0')='0' \n     AND EXTRACT ( MONTH FROM CI.NASCIMENTO ) = EXTRACT (MONTH FROM CURRENT_DATE) \n     AND EXTRACT ( DAY FROM CI.NASCIMENTO ) = EXTRACT (DAY FROM CURRENT_DATE) \n     AND C.PESSOA = 'F' \n    ",s,(function(e,n){e?console.log(e):o(n)})),2===e.cod_evento&&a.executeQueryERP(n," \n    SELECT DISTINCT 2 as cod_evento \n     , R.RECEBER as COD_RECEBER \n     , C.CLIENTE AS ID_CLIENTE \n     , cast(c.nome as varchar(100) character set ISO8859_1) AS NOME \n     , cast(CI.RAZAO as varchar(100) character set ISO8859_1) AS RAZAOSOCIAL \n     , case when POSITION(' ' in C.NOME) = 0 then cast(c.nome as varchar(100) character set ISO8859_1) else cast(SUBSTRING(C.NOME from 1 for POSITION(' ' in C.NOME)) as varchar(100) character set ISO8859_1) end AS PRIMEIRONOME \n     , (EXTRACT (YEAR FROM CURRENT_DATE) -  EXTRACT ( YEAR FROM CI.NASCIMENTO )) AS IDADE \n     , R.VALOR \n     , (R.VRPAGO+R.MULTA+R.JUROS-R.DESCONTO) AS VALORBAIXA \n     , R.DTVENC AS VENCIMENTO \n     , R.DTDOC AS DTDOC \n     , R.DTPGTO AS DTPGTO \n     , R.NUMDOC \n     , (select first(1) b.des_linha_digitavel from boleto b join boletoreceber br on br.blt_id = b.blt_id where br.rcb_id = r.receber) as codigodebarrasboleto \n     , CE.TELEFONE as TELEFONE1 \n     , CE2.TELEFONE as TELEFONE2 \n     , cast(r.historico as varchar(100) character set ISO8859_1) AS historico \n     FROM CLIENTE C \n     LEFT JOIN CLI_ENDE CE ON CE.CLIENTE = C.CLIENTE AND CE.TIPO = 'R' \n     LEFT JOIN CLI_ENDE CE2 ON CE2.CLIENTE = C.CLIENTE AND CE2.TIPO = 'T' \n     LEFT JOIN CLI_COMP CI ON CI.CLIENTE = C.CLIENTE \n     LEFT JOIN RECEBER R ON R.CLIENTE = C.CLIENTE \n     WHERE \n     (CE.TIPO = 'R') \n     and coalesce(c.flg_inativo,'0')='0' \n     AND R.VALOR > 0 \n     AND R.dtpgto <> R.dtdoc \n     AND R.dtpgto >= CURRENT_DATE - 3 \n    ",s,(function(e,n){e?console.log(e):o(n)})),3===e.cod_evento&&a.executeQueryERP(n,T,s,(function(e,n){e?console.log(e):o(n)})),4===e.cod_evento&&(s.push(e.cjoperacao),a.executeQueryERP(n,"\n    SELECT DISTINCT 4 as cod_evento \n     , V.VENDA AS COD_VENDA \n     , C.CLIENTE AS ID_CLIENTE \n     , cast(c.nome as varchar(100) character set ISO8859_1) AS NOME \n     , cast(CI.RAZAO as varchar(100) character set ISO8859_1) AS RAZAOSOCIAL \n     , case when POSITION(' ' in C.NOME) = 0 then cast(c.nome as varchar(100) character set ISO8859_1) else cast(SUBSTRING(C.NOME from 1 for POSITION(' ' in C.NOME)) as varchar(100) character set ISO8859_1) end AS PRIMEIRONOME \n     , (EXTRACT (YEAR FROM CURRENT_DATE) -  EXTRACT ( YEAR FROM CI.NASCIMENTO )) AS IDADE \n     , V.TOTALDOC AS VALOR \n     , null AS VENCIMENTO \n     , V.NRODOC AS NUMDOC \n     , '' as codigodebarrasboleto \n     , CE.TELEFONE as TELEFONE1 \n     , CE2.TELEFONE as TELEFONE2 \n     FROM VENDA V \n     JOIN CLIENTE C ON C.CLIENTE = V.CLIENTE \n     LEFT JOIN CLI_ENDE CE ON CE.CLIENTE = C.CLIENTE AND CE.TIPO = 'R' \n     LEFT JOIN CLI_ENDE CE2 ON CE2.CLIENTE = C.CLIENTE AND CE2.TIPO = 'T' \n     LEFT JOIN CLI_COMP CI ON CI.CLIENTE = C.CLIENTE \n     WHERE \n     V.DATDOC = CURRENT_DATE \n     AND V.OPERACAO IN ( SELECT CJ.OPERACAOD FROM CJOPERACAO CJ WHERE CJ.OPERACAOM = ? ) \n    ",s,(function(e,n){e?console.log(e):o(n)})))})))))E.push(...e);for await(const o of O.map(((t,E)=>new Promise(((t,r)=>{if(0===O[E].diasfixos)if(E<O.length-1){let r=`\n                    SELECT DISTINCT ${O[E].cod_evento} as cod_evento \n                     , 2 as tipo_evento \n                     , R.RECEBER as COD_RECEBER \n                     , C.CLIENTE AS ID_CLIENTE \n                     , cast(c.nome as varchar(100) character set ISO8859_1) AS NOME \n                     , cast(CI.RAZAO as varchar(100) character set ISO8859_1) AS RAZAOSOCIAL \n                     , case when POSITION(' ' in C.NOME) = 0 then cast(c.nome as varchar(100) character set ISO8859_1) else cast(SUBSTRING(C.NOME from 1 for POSITION(' ' in C.NOME)) as varchar(100) character set ISO8859_1) end AS PRIMEIRONOME \n                     , (EXTRACT (YEAR FROM CURRENT_DATE) -  EXTRACT ( YEAR FROM CI.NASCIMENTO )) AS IDADE \n                     , (R.VALOR) AS VALOR \n                     , (R.VALOR+R.MULTA+R.JUROS-R.DESCONTO) AS VALORBAIXA \n                     , R.DTVENC AS VENCIMENTO \n                     , R.DTDOC AS DTDOC \n                     , R.NUMDOC \n                     , (select first(1) b.des_linha_digitavel from boleto b join boletoreceber br on br.blt_id = b.blt_id where br.rcb_id = r.receber) as codigodebarrasboleto \n                     , CE.TELEFONE as TELEFONE1 \n                     , CE2.TELEFONE as TELEFONE2 \n                     , cast(r.historico as varchar(100) character set ISO8859_1) AS historico\n                     FROM CLIENTE C \n                     LEFT JOIN CLI_ENDE CE ON CE.CLIENTE = C.CLIENTE AND CE.TIPO = 'R' \n                     LEFT JOIN CLI_ENDE CE2 ON CE2.CLIENTE = C.CLIENTE AND CE2.TIPO = 'T' \n                     LEFT JOIN CLI_COMP CI ON CI.CLIENTE = C.CLIENTE \n                     left join receber r on r.cliente = c.cliente \n                     LEFT JOIN BOLETORECEBER BR ON BR.RCB_ID = R.RECEBER \n                     LEFT JOIN BOLETO B ON B.BLT_ID = BR.BLT_ID \n                     WHERE \n                     (CE.TIPO = 'R') \n                     AND coalesce(c.flg_inativo,'0')='0' \n                     AND (R.TIPO = 'R'  OR R.TIPO IS NULL) \n                     AND R.DTPGTO IS NULL \n                     AND R.VALOR > 0 \n                     AND R.dtvenc between CURRENT_DATE - ${O[E+1].dias-1} AND CURRENT_DATE - ${O[E].dias}  \n                    `;e&&1===e.boletosemitidos&&(r+=" AND B.BLT_BOLETO IS NOT NULL "),a.executeQueryERP(n,r,s,(async function(e,n){e?(o.status(500).json(e),console.log(e)):t(n)}))}else{let r=`\n                    SELECT DISTINCT ${O[E].cod_evento} as cod_evento \n                     , 2 as tipo_evento \n                     , R.RECEBER as COD_RECEBER \n                     , C.CLIENTE AS ID_CLIENTE \n                     , cast(c.nome as varchar(100) character set ISO8859_1) AS NOME \n                     , cast(CI.RAZAO as varchar(100) character set ISO8859_1) AS RAZAOSOCIAL \n                     , case when POSITION(' ' in C.NOME) = 0 then cast(c.nome as varchar(100) character set ISO8859_1) else cast(SUBSTRING(C.NOME from 1 for POSITION(' ' in C.NOME)) as varchar(100) character set ISO8859_1) end AS PRIMEIRONOME \n                     , (EXTRACT (YEAR FROM CURRENT_DATE) -  EXTRACT ( YEAR FROM CI.NASCIMENTO )) AS IDADE \n                     , (R.VALOR) AS VALOR \n                     , (R.VALOR+R.MULTA+R.JUROS-R.DESCONTO) AS VALORBAIXA \n                     , R.DTVENC AS VENCIMENTO \n                     , R.DTDOC AS DTDOC \n                     , R.NUMDOC \n                     , (select first(1) b.des_linha_digitavel from boleto b join boletoreceber br on br.blt_id = b.blt_id where br.rcb_id = r.receber) as codigodebarrasboleto \n                     , CE.TELEFONE as TELEFONE1 \n                     , CE2.TELEFONE as TELEFONE2 \n                     , cast(r.historico as varchar(100) character set ISO8859_1) AS historico\n                     FROM CLIENTE C \n                     LEFT JOIN CLI_ENDE CE ON CE.CLIENTE = C.CLIENTE AND CE.TIPO = 'R' \n                     LEFT JOIN CLI_ENDE CE2 ON CE2.CLIENTE = C.CLIENTE AND CE2.TIPO='T' \n                     LEFT JOIN CLI_COMP CI ON CI.CLIENTE = C.CLIENTE \n                     left join receber r on r.cliente = c.cliente \n                     LEFT JOIN BOLETORECEBER BR ON BR.RCB_ID = R.RECEBER \n                     LEFT JOIN BOLETO B ON B.BLT_ID = BR.BLT_ID \n                     WHERE \n                     (CE.TIPO = 'R') \n                     AND coalesce(c.flg_inativo,'0')='0' \n                     AND (R.TIPO = 'R'  OR R.TIPO IS NULL) \n                     AND R.DTPGTO IS NULL \n                     AND R.VALOR > 0 \n                     AND R.dtvenc between CURRENT_DATE - ${O[E].maxdiasatraso+O[E].dias} AND CURRENT_DATE - ${O[E].dias} \n                    `;e&&1===e.boletosemitidos&&(r+=" AND B.BLT_BOLETO IS NOT NULL "),a.executeQueryERP(n,r,s,(async function(e,n){e?(o.status(500).json(e),console.log(e)):t(n)}))}else{let r=`\n                    SELECT DISTINCT ${O[E].cod_evento} as cod_evento \n                     , 2 as tipo_evento \n                     , R.RECEBER as COD_RECEBER \n                     , C.CLIENTE AS ID_CLIENTE \n                     , cast(c.nome as varchar(100) character set ISO8859_1) AS NOME \n                     , case when POSITION(' ' in C.NOME) = 0 then cast(c.nome as varchar(100) character set ISO8859_1) else cast(SUBSTRING(C.NOME from 1 for POSITION(' ' in C.NOME)) as varchar(100) character set ISO8859_1) end AS PRIMEIRONOME \n                     , cast(CI.RAZAO as varchar(100) character set ISO8859_1) AS RAZAOSOCIAL \n                     , (EXTRACT (YEAR FROM CURRENT_DATE) -  EXTRACT ( YEAR FROM CI.NASCIMENTO )) AS IDADE \n                     , R.VALOR \n                     , (R.VALOR+R.MULTA+R.JUROS-R.DESCONTO) AS VALORBAIXA \n                     , R.DTVENC AS VENCIMENTO \n                     , R.DTDOC AS DTDOC \n                     , R.NUMDOC \n                     , (select first(1) b.des_linha_digitavel from boleto b join boletoreceber br on br.blt_id = b.blt_id where br.rcb_id = r.receber) as codigodebarrasboleto \n                     , CE.TELEFONE as TELEFONE1 \n                     , CE2.TELEFONE as TELEFONE2 \n                     , cast(r.historico as varchar(100) character set ISO8859_1) AS historico\n                     FROM CLIENTE C \n                     LEFT JOIN CLI_ENDE CE ON CE.CLIENTE = C.CLIENTE AND CE.TIPO = 'R' \n                     LEFT JOIN CLI_ENDE CE2 ON CE2.CLIENTE = C.CLIENTE AND CE2.TIPO='T' \n                     LEFT JOIN CLI_COMP CI ON CI.CLIENTE = C.CLIENTE \n                     left join receber r on r.cliente = c.cliente \n                     LEFT JOIN BOLETORECEBER BR ON BR.RCB_ID = R.RECEBER \n                     LEFT JOIN BOLETO B ON B.BLT_ID = BR.BLT_ID \n                     WHERE \n                     (CE.TIPO = 'R') \n                     AND coalesce(c.flg_inativo,'0')='0' \n                     AND (R.TIPO = 'R'  OR R.TIPO IS NULL) \n                     AND R.DTPGTO IS NULL \n                     AND R.VALOR > 0 \n                     AND R.dtvenc = CURRENT_DATE - ${O[E].dias} \n                    `;e&&1===e.boletosemitidos&&(r+=" AND B.BLT_BOLETO IS NOT NULL "),a.executeQueryERP(n,r,s,(async function(e,n){e?(o.status(500).json(e),console.log(e)):t(n)}))}})))))E.push(...o);for await(const e of l.map((e=>new Promise(((o,t)=>{s=[],a.executeQueryERP(n,e.sql,s,(function(e,n){e?console.log(e):o(n)}))})))))E.push(...e);return await new Promise(((e,o)=>{e(async function(e){let o=t.readFileSync("./config.json"),n=JSON.parse(o),s=new Date;s.setHours(0,0,0,0);const E={host:n.hostsl,port:n.porta,database:n.caminhoBancoServerLog,user:n.usuario,password:n.senha,lowercase_keys:!0,role:null,pageSize:16384};r.attach(E,(function(o,n){if(o)return o;n.transaction(r.ISOLATION_READ_COMMITTED,(async function(o,t){if(o)return t.rollback(),o;for(let o=0;o<e.length;o++){let n=e[o],E="UPDATE OR INSERT INTO EVENTOS(COD_EVENTO,TIPO_EVENTO,COD_RECEBER,COD_VENDA,ID_CLIENTE,NOME,TELEFONE1,TELEFONE2,DATA,DTDOC,PRIMEIRONOME,IDADE,VALOR,VALORBAIXA,VENCIMENTO,NUMDOC,CODIGODEBARRASBOLETO, RAZAOSOCIAL, MENSAGEM, DTPGTO, HISTORICO) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,(SELECT CAST(CF.MENSAGEM as VARCHAR(1000)) AS MENSAGEM FROM CFGEVENTOS CF WHERE CF.COD_EVENTO = ? ),?,?) MATCHING (COD_EVENTO, ID_CLIENTE, COD_RECEBER, COD_VENDA, DATA)",r=[parseInt(n.cod_evento),n.tipo_evento,parseInt(n.cod_receber),parseInt(n.cod_venda),parseInt(n.id_cliente),n.nome,n.telefone1,n.telefone2,s,n.dtdoc,n.primeironome,n.idade,n.valor,n.valorbaixa,n.vencimento,n.numdoc,n.codigodebarrasboleto,n.razaosocial,parseInt(n.cod_evento),n.dtpgto,n.historico];await a.executeQueryTransaction(t,E,r,(function(e,o){e&&t.rollback()}))}return t.commit((function(e){if(e)return t.rollback(),e})),n.detach(),o}))}))}(E))})),E.length}async function i(e,o,n){let s=t.readFileSync("./config.json"),E=JSON.parse(s);const c={host:E.hostsl,port:E.porta,database:E.caminhoBancoServerLog,user:E.usuario,password:E.senha,lowercase_keys:!0,role:null,pageSize:16384};r.attach(c,(function(n,t){if(n)return!!o&&o(n,null);t.transaction(r.ISOLATION_READ_COMMITTED,(async function(n,s){if(n)return s.rollback(),!!o&&o(n,null);for(let o=0;o<e.length;o++){let n=e[o],t="UPDATE OR INSERT INTO EVENTOS(ID,MSGENVIADA, STATUS, LOG) VALUES (?,?,?,?) MATCHING (ID)",E=[parseInt(n.id),n.msgenviada,n.status,n.log];await a.executeQueryTransaction(s,t,E,(function(e,o){e&&s.rollback()}))}return s.commit((function(e){if(e)return s.rollback(),!!o&&o(e,null)})),t.detach(),!o||o(null,!0)}))}))}async function O(e,o){let n=t.readFileSync("./config.json"),r=JSON.parse(n),c=[];a.executeQuerySL(r,"SELECT E.*, \n        C.DESCRICAO AS EVENTO, \n        CAST(E.MENSAGEM AS VARCHAR(5000)) AS MENSAGEM, \n        (select c.msgunica from cfgall c) as msgunica \n    FROM EVENTOS E \n    JOIN CFGEVENTOS C ON C.COD_EVENTO = E.COD_EVENTO \n    WHERE E.DATA = CURRENT_DATE \n    AND (E.STATUS = 'Pendente' or E.STATUS = 'Erro') \n    AND (C.MANUAL <> 1)\n    ORDER BY E.VENCIMENTO,E.ID_CLIENTE",[],(async function(n,t){if(n)console.log(n);else if(e&&(t=e),t.length>0&&0===t[0].msgunica){for(let e=0;e<t.length;e++){let o=t[e];if(o.mensagem=await s.replaceVariables(o.mensagem,o),""!==o.telefone1&&null!==o.telefone1||""!==o.telefone2&&null!==o.telefone2){if("Pendente"===o.status||"Erro"===o.status){const e=600*Math.random()+200;await new Promise((o=>setTimeout(o,e))),await E.sendText(o.telefone1,o.telefone2,o.mensagem,(function(e){if("OK"===e.status){o.status="Enviado",o.log="",o.msgenviada=o.mensagem;let e="UPDATE OR INSERT INTO EVENTOS(ID,MSGENVIADA, STATUS, LOG) VALUES (?,?,?,?) MATCHING (ID)",n=[parseInt(o.id),o.msgenviada,o.status,o.log];a.executeQuerySL(r,e,n,(function(e,o){e&&console.log(e)}))}else console.log(e),o.status="Erro",o.log="Numero Invalido"}))}}else o.status="Erro",o.log="Sem Numero";"Enviado"!==o.status&&c.push(o)}await new Promise(((e,n)=>{e(i(c,o))}))}else{for(let e=0;e<t.length;e++){let o=t[e];if(""!==o.telefone1&&null!==o.telefone1||""!==o.telefone2&&null!==o.telefone2)if(!o.tipo_evento||2!==o.tipo_evento||"Pendente"!==o.status&&"Erro"!==o.status)"Pendente"!==o.status&&"Erro"!==o.status||(o.mensagem=await s.replaceVariables(o.mensagem,o),""!==o.telefone1&&null!==o.telefone1||""!==o.telefone2&&null!==o.telefone2?await E.sendText(o.telefone1,o.telefone2,o.mensagem,(function(e){if("OK"===e.status){o.status="Enviado",o.log="",o.msgenviada=o.mensagem;let e="UPDATE OR INSERT INTO EVENTOS(ID,MSGENVIADA, STATUS, LOG) VALUES (?,?,?,?) MATCHING (ID)",n=[parseInt(o.id),o.msgenviada,o.status,o.log];a.executeQuerySL(r,e,n,(function(e,o){e&&console.log(e)}))}else console.log(e),o.status="Erro",o.log="Numero Invalido"})):(o.status="Erro",o.log="Sem Numero"));else{let e=[];await t.map((n=>{n.id_cliente!==o.id_cliente||!n.tipo_evento||2!==n.tipo_evento||"Pendente"!==n.status&&"Erro"!==n.status||(""!==n.telefone1&&null!==n.telefone1||""!==n.telefone2&&null!==n.telefone2?(e.push(n),n.status="Enviado",n.log="Mensagem agrupada"):(n.status="Erro",n.log="Sem Número"))})),o.mensagem=await s.replaceVariables(o.mensagem,o,e);const n=600*Math.random()+200;await new Promise((e=>setTimeout(e,n))),await E.sendText(o.telefone1,o.telefone2,o.mensagem,(async function(n){if("OK"===n.status)return o.status="Enviado",o.log="Mensagem agrupada",o.msgenviada=o.mensagem,await i(e),!0;e.map((e=>{console.log(n),e.status="Erro",e.log="Numero Invalido"}))}))}else o.status="Erro",o.log="Sem Número";"Enviado"!==o.status&&c.push(o)}await new Promise(((e,n)=>{e(i(c,o))}))}}))}e.exports={init:async function(){let e=0,o=[];o[0]=new Promise(((o,n)=>{o(c().then((o=>e=o)))})),await Promise.all(o),o[0]=new Promise((o=>setTimeout(o,1e3+10*e))),await Promise.all(o),o[0]=new Promise((e=>e(O()))),await Promise.all(o)},carregaEventos:c,enviaEventos:O,enviaPromocao:async function(e,o){let n=new Date;n.setHours(0,0,0,0);let c=t.readFileSync("./config.json"),i=JSON.parse(c),O=[];const l=e.clients,T=e.products,C=e.mensagensPromo,N=e.promoSelecionada;for(let e=0;e<l.length;e++){let o=l[e];if(o.mensagem=await s.replaceVariables(C.mensagem,o),""!==o.telefone1&&null!==o.telefone1||""!==o.telefone2&&null!==o.telefone2){if("Enviado"!==o.status){const e=600*Math.random()+200;await new Promise((o=>setTimeout(o,e))),await E.sendText(o.telefone1,o.telefone2,o.mensagem,(async function(e){if("OK"===e.status){for(let e=0;e<T.length;e++){let n=T[e];if(n.caminhofoto){n.legenda=await s.replaceVariables(C.legenda,n);const e=600*Math.random()+200;await new Promise((o=>setTimeout(o,e))),await E.sendImage(o.telefone1,o.telefone2,n.caminhofoto,n.legenda,(async function(e){}))}}o.status="Enviado",o.log="";let e=" UPDATE OR INSERT INTO PROMOCAO_LOGS(DATA,ID_PROMOCAO,ID_CLIENTE,STATUS) VALUES (?,?,?,?) MATCHING (DATA,ID_PROMOCAO,ID_CLIENTE,STATUS) ",t=[n,N.cod_promocao,o.cliente,o.status];a.executeQuerySL(i,e,t,(function(e,o){e&&console.log(e)}))}else console.log(e),o.status="Erro",o.log="Numero Invalido"}))}}else o.status="Erro",o.log="Sem Numero";o.cod_promocao=N.cod_promocao,"Enviado"!==o.status&&O.push(o)}await new Promise(((e,n)=>{e(async function(e,o){let n=new Date;n.setHours(0,0,0,0);let s=t.readFileSync("./config.json"),E=JSON.parse(s);const c={host:E.hostsl,port:E.porta,database:E.caminhoBancoServerLog,user:E.usuario,password:E.senha,lowercase_keys:!0,role:null,pageSize:16384};r.attach(c,(function(t,s){if(t)return!!o&&o(t,null);s.transaction(r.ISOLATION_READ_COMMITTED,(async function(t,E){if(t)return E.rollback(),!!o&&o(t,null);for(let o=0;o<e.length;o++){let t=e[o],s=" UPDATE OR INSERT INTO PROMOCAO_LOGS(DATA,ID_PROMOCAO,ID_CLIENTE,STATUS) VALUES (?,?,?,?) MATCHING (DATA,ID_PROMOCAO,ID_CLIENTE,STATUS) ",r=[n,t.cod_promocao,t.cliente,t.status];await a.executeQueryTransaction(E,s,r,(function(e,o){e&&E.rollback()}))}return E.commit((function(e){if(e)return E.rollback(),!!o&&o(e,null)})),s.detach(),!o||o(null,!0)}))}))}(O,o))}))}}},38:(e,o,n)=>{const t=n(419);e.exports={executeQueryERP:function(e,o,n,a){const s={host:e.host,hostsl:e.hostsl,port:e.porta,database:e.caminhoBanco,user:e.usuario,password:e.senha,lowercase_keys:!0,role:null,pageSize:16384};t.attach(s,(function(e,t){if(e)return a(e,[]);t.query(o,n,(function(e,o){return t.detach(),e?a(e,[]):(o.map((e=>{for(const o in e){let n=e[o];!0===Buffer.isBuffer(n)&&(e[o]=n.toString("utf-8").trim())}})),a(void 0,o))}))}))},executeQuerySL:async function(e,o,n,a){const s={host:e.hostsl,port:e.porta,database:e.caminhoBancoServerLog,user:e.usuario,password:e.senha,lowercase_keys:!0,role:null,pageSize:16384};t.attach(s,(async function(e,t){if(e)return a(e,[]);t.query(o,n,(async function(e,o){return t.detach(),e?a(e,[]):a(void 0,o)}))}))},executeTransactionSL:async function(e,o,n,a){const s={host:e.hostsl,port:e.porta,database:e.caminhoBancoServerLog,user:e.usuario,password:e.senha,lowercase_keys:!0,role:null,pageSize:16384};t.attach(s,(async function(e,s){if(e)return a(e,[]);await new Promise(((e,E)=>{s.transaction(t.ISOLATION_READ_COMMITED,(function(t,E){for(let t=0;t<n.length;t++)E.query(o,n[t],(function(o,n){o?E.rollback():E.commit((function(o){if(!o)return s.detach(),e(n),a(void 0,!0);E.rollback()}))}))}))}))}))},executeQueryTransaction2:async function(e,o,n){return new Promise(((t,a)=>{e.query(o,n,(function(e,o){return e?(console.log(e),t(!0)):t(o)}))}))},testCon:function(e,o){const n={host:e.host,port:e.porta,database:e.caminhoBanco,user:e.usuario,password:e.senha,lowercase_keys:!0,role:null,pageSize:16384};t.attach(n,(function(n,a){if(n)return o(n,[]);{const n={hostsl:e.hostsl,port:e.porta,database:e.caminhoBancoServerLog,user:e.usuario,password:e.senha,lowercase_keys:!0,role:null,pageSize:16384};t.attach(n,(function(e,n){return e?o(e,[]):o(void 0,void 0)}))}}))},firebird:t,executeQueryTransaction:async function(e,o,n){return new Promise(((t,a)=>{e.query(o,n,(function(e,o){return e?a(e):t(o)}))}))}}},40:e=>{e.exports={replaceVariables:(e,o,n)=>{const t={"{nome}":o.nome&&o.nome.trim(),"{primeironome}":o.primeironome&&o.primeironome.trim(),"{razaosocial}":o.razaosocial&&o.razaosocial.trim(),"{idade}":o.idade,"{data}":o.data&&new Date(o.data).toLocaleDateString("pt-BR"),"{dtdoc}":o.dtdoc&&new Date(o.dtdoc).toLocaleDateString("pt-BR"),"{dtpgto}":o.dtpgto&&new Date(o.dtpgto).toLocaleDateString("pt-BR"),"{valor}":o.valor&&parseFloat(o.valor).toFixed(2),"{valorbaixa}":o.valorbaixa&&parseFloat(o.valorbaixa).toFixed(2),"{vencimento}":o.vencimento&&new Date(o.vencimento).toLocaleDateString("pt-BR"),"{numdoc}":o.numdoc,"{historico}":""!==o.historico&&null!==o.historico?"*Historico:* "+o.historico:"","{codigodebarrasboleto}":""!==o.codigodebarrasboleto&&null!==o.codigodebarrasboleto?`Para efetuar o pagamento utilize a linha digitavel: ${o.codigodebarrasboleto}`:"","{blocotitulos}":n&&n.map((e=>"*Documento:* "+e.numdoc+"\n*Data da Compra:* "+new Date(e.dtdoc).toLocaleDateString("pt-BR")+"\n*Vencimento:* "+new Date(e.vencimento).toLocaleDateString("pt-BR")+"\n*Valor:* R$ "+e.valor.toFixed(2)+"\n"+(""!==e.codigodebarrasboleto&&null!==e.codigodebarrasboleto?"*Linha Digitável:* "+e.codigodebarrasboleto+"\n\n":"\n"))).join(""),"{blocotituloshistorico}":n&&n.map((e=>"*Documento:* "+e.numdoc+"\n*Data da Compra:* "+new Date(e.dtdoc).toLocaleDateString("pt-BR")+"\n*Vencimento:* "+new Date(e.vencimento).toLocaleDateString("pt-BR")+"\n*Valor:* R$ "+e.valor.toFixed(2)+"\n"+(""!==e.historico&&null!==e.historico?"*Historico:* "+e.historico+"\n":"")+(""!==e.codigodebarrasboleto&&null!==e.codigodebarrasboleto?"*Linha Digitável:* "+e.codigodebarrasboleto+"\n\n":"\n"))).join(""),"{blocotitulosvrtotal}":n&&n.map((e=>"*Documento:* "+e.numdoc+"\n*Data da Compra:* "+new Date(e.dtdoc).toLocaleDateString("pt-BR")+"\n*Vencimento:* "+new Date(e.vencimento).toLocaleDateString("pt-BR")+"\n*Valor:* R$ "+e.valorbaixa.toFixed(2)+"\n"+(""!==e.codigodebarrasboleto&&null!==e.codigodebarrasboleto?"*Linha Digitável:* "+e.codigodebarrasboleto+"\n\n":"\n"))).join(""),"{blocotitulosvrtotalhistorico}":n&&n.map((e=>"*Documento:* "+e.numdoc+"\n*Data da Compra:* "+new Date(e.dtdoc).toLocaleDateString("pt-BR")+"\n*Vencimento:* "+new Date(e.vencimento).toLocaleDateString("pt-BR")+"\n*Valor:* R$ "+e.valorbaixa.toFixed(2)+"\n"+(""!==e.historico&&null!==e.historico?"*Historico:* "+e.historico+"\n":"")+(""!==e.codigodebarrasboleto&&null!==e.codigodebarrasboleto?"*Linha Digitável:* "+e.codigodebarrasboleto+"\n\n":"\n"))).join(""),"{nomeproduto}":o.nomeproduto,"{valororiginal}":o.valororiginal&&parseFloat(o.valororiginal).toFixed(2),"{valorpromocional}":o.valorpromocional&&parseFloat(o.valorpromocional).toFixed(2),"{percentualdesconto}":o.percentualdesconto};return e.replace(/{nome}|{primeironome}|{razaosocial}|{idade}|{data}|{dtdoc}|{dtpgto}|{valor}|{valorbaixa}|{vencimento}|{numdoc}|{codigodebarrasboleto}|{blocotitulos}|{blocotitulosvrtotal}|{blocotituloshistorico}|{blocotitulosvrtotalhistorico}|{nomeproduto}|{valororiginal}|{valorpromocional}|{percentualdesconto}|{historico}/gi,(e=>t[e]))}}},832:(e,o,n)=>{const t=n(121),{Client:a,LocalAuth:s,MessageMedia:E}=n(55),r=n(572),c=new a({authStrategy:new s,userDataDir:"./.wwebjs_auth/session"});let i,O="Conectando";async function l(e){let o=null,n="";return e&&null!==e&&""!==e&&(n=r(e.toString(),"BR")?.format("E.164")?.replace("+",""),n&&parseFloat(n.substr(2,2))>=22&&13===n.length&&(n=n.substr(0,4)+n.substr(5,8)),n=n&&n.includes("@c.us")?n:`${n}@c.us`),null===o&&(o=n),o}async function T(e,o,n){let t=null;return null!==e&&""!==e||null!==o&&""!==o?(null!==o&&""!==o?await c.isRegisteredUser(o).then((async n=>{if(n)t=o;else{if(null===e||""===e)return!1;await c.isRegisteredUser(e).then((o=>{if(!o)return!1;t=e}))}})):await c.isRegisteredUser(e).then((o=>{if(!o)return!1;t=e})),t):n({error:"ERROR SEM NUMERO"})}c.on("qr",(e=>{t.toDataURL(e,(function(e,o){console.log(o),i=o}))})),c.on("ready",(()=>{console.log("Client is ready!"),O=!0})),e.exports={initialize:()=>{c.initialize()},sendText:async function(e,o,n,t){console.log("chamou o trem");let a=await l(e),s=await l(o),E=null;if(E=await T(a,s,t),!E)return t({error:"ERROR NUMERO INVALIDO"});await c.sendMessage(E,n).then((()=>t({status:"OK"}))).catch((e=>{console.log(e)}))},sendImage:async function(e,o,n,t,a){let s=await l(e),r=await l(o),i=null;if(i=await T(s,r,a),!i)return a({error:"ERROR NUMERO INVALIDO"});{const e=new E.fromFilePath(n);c.sendMessage(i,e,{caption:t}).then((()=>{a({status:"OK"})})).catch((e=>{console.log(e)}))}},qrCode:()=>i,isConnected:()=>O}},618:(e,o,n)=>{const t=n(147),a=n(419),s=n(38);e.exports={updateVersion:async e=>{let o,n=t.readFileSync("./config.json"),E=JSON.parse(n);const r={host:E.hostsl,port:E.porta,database:E.caminhoBancoServerLog,user:E.usuario,password:E.senha,lowercase_keys:!0,role:null,pageSize:16384};await s.executeQuerySL(E,"SELECT C.VERSAO FROM CFGALL C",[],(async function(n,t){if(n)console.log(n);else for(o=t[0].versao;;){if(9===o)return e(null,!0);if(o<1){console.log("Versao 1");let e=[];e[0]="ALTER TABLE CFGALL ADD REMOTO SMALLINT;",e[1]="ALTER TABLE CFGALL ADD CAMINHOREDE VARCHAR(50);",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Paso > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=1}if(o<2){console.log("Versao 2");let e=[];e[0]=" CREATE TABLE EVENTOS_EXCECAO(COD_EVENTO INTEGER,ID_CLIENTE INTEGER); ",e[1]=" CREATE PROCEDURE DEL_EVE_EXCE AS BEGIN EXIT; END ",e[2]="\nALTER PROCEDURE DEL_EVE_EXCE AS\ndeclare variable EVENTO integer;\ndeclare variable CLIENTE integer;\nBEGIN\n    FOR SELECT COD_EVENTO, ID_CLIENTE FROM eventos_excecao INTO :EVENTO, :CLIENTE\n    DO\n    BEGIN\n        UPDATE EVENTOS E SET E.status = 'Excecao' where E.cod_evento = :EVENTO and e.id_cliente = :CLIENTE and E.DATA = current_date and E.STATUS <> 'Enviado';\n    END\nEND\n                    ",e[3]="\nCREATE TRIGGER EVENTOS_EXCECAO_BD0 FOR EVENTOS_EXCECAO\nACTIVE BEFORE DELETE POSITION 0 \nAS\nbegin\nupdate eventos e set e.status = 'Pendente' where e.cod_evento = old.cod_evento and e.id_cliente = old.id_cliente and e.data = current_date;\nend\n                     ",e[4]="\nALTER TRIGGER EVENTOS_BI\nas\nbegin\nif (new.id is null) then\n    new.id = gen_id(gen_eventos_id,1);\n\nif (exists (select * from EVENTOS_EXCECAO E WHERE E.cod_evento = new.cod_evento and e.id_cliente = new.id_cliente))\nthen new.status = 'Excecao';\nend\n",e[5]=" ALTER TABLE CFGALL ALTER COLUMN AUTOMATOR POSITION 1; ",e[6]=" ALTER TABLE CFGALL ALTER COLUMN LASTLOGIN POSITION 2; ",e[7]=" ALTER TABLE CFGALL ALTER COLUMN LASTUSER POSITION 3; ",e[8]=" ALTER TABLE CFGALL ALTER COLUMN DIASFIXOS POSITION 4; ",e[9]=" ALTER TABLE CFGALL ALTER COLUMN MAXDIASATRASO POSITION 5; ",e[10]=" ALTER TABLE CFGALL ALTER COLUMN MSGUNICA POSITION 6; ",e[11]=" ALTER TABLE CFGALL ALTER COLUMN REMOTO POSITION 7; ",e[12]=" ALTER TABLE CFGALL ALTER COLUMN CAMINHOREDE POSITION 8; ",e[13]=" GRANT ALL ON EVENTOS_EXCECAO TO SYSDBA WITH GRANT OPTION; ",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Passo > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=2}if(o<3){console.log("Versao 3");let e=[];e[0]=" ALTER TABLE PROMOCAO_LOGS DROP CONSTRAINT PK_PROMOCAO_LOGS; ",e[1]=" DROP TRIGGER PROMOCAO_LOGS_BI; ",e[2]=" ALTER TABLE PROMOCAO_LOGS DROP ID; ",e[3]=" ALTER TABLE CFGALL ALTER COLUMN VERSAO POSITION 9; ",e[4]="ALTER TABLE PROMOCAO_LOGS ALTER COLUMN DATA POSITION 1;",e[5]="ALTER TABLE PROMOCAO_LOGS ALTER COLUMN ID_PROMOCAO POSITION 2;",e[6]="ALTER TABLE PROMOCAO_LOGS ALTER COLUMN ID_CLIENTE POSITION 3;",e[7]=" ALTER TABLE PROMOCAO_LOGS ALTER COLUMN STATUS POSITION 4; ",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Passo > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=3}if(o<4){console.log("Versao 4");let e=[];e[0]="CREATE OR ALTER trigger eventos_bi for eventos\n                    active before insert position 0\n                    as\n                    begin\n                    if (new.id is null) then\n                        new.id = gen_id(gen_eventos_id,1);\n                    \n                    if (exists (select * from EVENTOS_EXCECAO E WHERE E.cod_evento = new.cod_evento and e.id_cliente = new.id_cliente))\n                    then new.status = 'Excecao';\n                    \n                    if (new.cod_evento = 2 and (exists (select * from eventos ev where ev.data >= current_date - 5 and ev.cod_receber = new.cod_receber and ev.status = 'Enviado')))\n                    then new.status = 'Duplicado';\n                    end\n                    ",e[1]=" ALTER TABLE EVENTOS ADD DTPGTO DATE; ",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Passo > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=4}if(o<5){console.log("Versao 5");let e=[];e[0]=" ALTER TABLE CFGALL ADD BOLETOSEMITIDOS SMALLINT; ",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Passo > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=5}if(o<6){console.log("Versao 6");let e=[];e[0]=" update cfgall set boletosemitidos = 0; ",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Passo > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=6}if(o<7){console.log("Versao 7");let e=[];e[0]="\nCREATE OR ALTER trigger eventos_bi for eventos\nactive before insert position 0\nas\nbegin\nif (new.id is null) then\nnew.id = gen_id(gen_eventos_id,1);\n                    \nif (exists (select * from EVENTOS_EXCECAO E WHERE E.cod_evento = new.cod_evento and e.id_cliente = new.id_cliente))\nthen new.status = 'Excecao';\n                    \nif (new.cod_evento = 2 and (exists (select * from eventos ev where ev.data >= current_date - 5 and ev.cod_receber = new.cod_receber and ev.status = 'Enviado' and ev.cod_evento = 2)))\nthen new.status = 'Duplicado';\nend\n",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Passo > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=7}if(o<8){console.log("Versao 8");let e=[];e[0]=" ALTER TABLE CFGEVENTOS ADD MANUAL SMALLINT; ",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Passo > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=8}if(o<9){console.log("Versao 9");let e=[];e[0]=" ALTER TABLE EVENTOS ADD HISTORICO VARCHAR(80); ",await new Promise(((o,n)=>{a.attach(r,(function(n,t){n?(console.log(n),o(!0)):t.transaction(a.ISOLATION_READ_COMMITTED,(async function(n,a){if(n)a.rollback(),o(!0);else{for(let o=0;o<e.length;o++)console.log("Passo > "+o),await s.executeQueryTransaction2(a,e[o],[],(function(e,o){e&&a.rollback()}));a.commit((function(e){e&&a.rollback()})),t.detach(),o(!0)}}))}))})),o=9}let n=" UPDATE CFGALL SET VERSAO = ? ",t=[];t.push(o),await new Promise((e=>setTimeout(e,1e3))),await s.executeQuerySL(E,n,t,(async function(e,o){e&&console.log(e)}))}}))}}},167:e=>{"use strict";e.exports=require("axios")},582:e=>{"use strict";e.exports=require("cors")},860:e=>{"use strict";e.exports=require("express")},572:e=>{"use strict";e.exports=require("libphonenumber-js")},419:e=>{"use strict";e.exports=require("node-firebird")},121:e=>{"use strict";e.exports=require("qrcode")},55:e=>{"use strict";e.exports=require("whatsapp-web.js")},147:e=>{"use strict";e.exports=require("fs")}},o={};function n(t){var a=o[t];if(void 0!==a)return a.exports;var s=o[t]={exports:{}};return e[t](s,s.exports,n),s.exports}(()=>{const e=n(860),o=n(582),t=n(167),a=n(147),s=n(38),E=n(832),r=n(697),c=n(618),i=e();i.use(o()),i.use(e.urlencoded({extended:!1,limit:"50mb"})),i.use(e.json({limit:"50mb"}));try{E.initialize()}catch(e){console.log(e)}try{setInterval((function(){var e=new Date;e.getHours()>=8&&e.getHours()<=20&&async function(e){let o=a.readFileSync("./config.json"),n=JSON.parse(o);let E=[];s.executeQuerySL(n,"SELECT * FROM CFGALL",E,(function(o,a){if(o)console.log(o);else{const o=a[0];if(1!==o.automator)return e(!1);{const a=new Date;if(!o.lastlogin||a.getDay()>o.lastlogin.getDay()||a.getHours()>o.lastlogin.getHours())console.log("validou o usuario"),t.post("http://linkapi-trial.ddns.net:5020/auth/validate",{id:o.lastuser}).then((o=>{if(!o.data)return e(!1);{const o=" UPDATE CFGALL SET LASTLOGIN = ? ";E.push(a),s.executeQuerySL(n,o,E,(function(o,n){if(!o)return e(!0);console.log(o)}))}}));else{const o=" UPDATE CFGALL SET LASTLOGIN = ? ";E.push(a),s.executeQuerySL(n,o,E,(function(o,n){if(!o)return e(!0);console.log(o)}))}}}}))}((function(e){e?(console.log("Rodou o automator"),r.init()):console.log("login invalido ou automator desativado")}))}),3e5)}catch(e){console.log(e)}i.get("/status",((e,o)=>o.status(200).json({qr_code:E.qrCode(),connected:E.isConnected()}))),i.get("/state",((e,o)=>{E.state((function(e){return o.status(200).json(e)}))})),i.get("/initialize",((e,o)=>{try{return E.initialize(),o.status(200).json({})}catch(e){return console.log(e),o.status(200).json({})}})),i.post("/sendText",(async(e,o)=>{const{number1:n,number2:t,message:a}=e.body;await E.sendText(n,t,a,(function(e){return o.status(200).json(e)}))})),i.post("/sendImage",(async(e,o)=>{const{number1:n,number2:t,path:a,name:s,caption:r}=e.body;try{await E.sendImage(n,t,a,s,r,(function(e){return o.status(200).json(e)}))}catch(e){o.status(201).json(e)}})),i.post("/sendFile",(async(e,o)=>{const{number1:n,number2:t,path:a,name:s,caption:r}=e.body;try{await E.sendFile(n,t,a,s,r,(function(e){return o.status(200).json(e)}))}catch(e){console.log(e),o.status(201).json(e)}})),i.post("/sendButton",(async(e,o)=>{const{number1:n,number2:t,title:a,description:s,options:r}=e.body;try{await E.sendButton(n,t,a,s,r,(function(e,n){if(!n)return o.status(200).json(e);o.status(201).json(n)}))}catch(e){console.log(e),o.status(201).json(e)}})),i.post("/onMessage",(async(e,o)=>{try{await E.onMessage((function(e,o){}))}catch(e){console.log(e),o.status(201).json(e)}return o.status(200).json()})),i.get("/versao",((e,o)=>{c.updateVersion((function(e,n){return e?o.status(500).json(!1):o.status(200).json(!0)}))})),i.get("/cfgall",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n);s.executeQuerySL(t,"SELECT C.*, GEN_ID(gen_cfgeventos_id,0)+1 as proxid FROM CFGALL C",[],(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.post("/cfgall",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=" UPDATE CFGALL ",r=[];e.body.lastuser&&(E+=" SET LASTUSER = ? ",r.push(e.body.lastuser)),0!==e.body.automator&&1!==e.body.automator||(E+=" SET AUTOMATOR = ? ",r.push(e.body.automator)),0!==e.body.diasfixos&&1!==e.body.diasfixos||(E+=" SET DIASFIXOS = ? ",r.push(e.body.diasfixos)),e.body.maxdiasatraso&&(E+=" SET MAXDIASATRASO = ? ",r.push(e.body.maxdiasatraso)),0!==e.body.msgunica&&1!==e.body.msgunica||(E+=" SET MSGUNICA = ? ",r.push(e.body.msgunica)),0!==e.body.remoto&&1!==e.body.remoto||(E+=" SET REMOTO = ? ",r.push(e.body.remoto)),0!==e.body.boletosemitidos&&1!==e.body.boletosemitidos||(E+=" SET BOLETOSEMITIDOS = ? ",r.push(e.body.boletosemitidos)),e.body.caminhorede&&(E+=" SET CAMINHOREDE = ? ",r.push(e.body.caminhorede)),s.executeQuerySL(t,E,r,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/statusdb",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n);if(JSON.stringify(t)!==JSON.stringify(e.query)){t=e.query;let o=JSON.stringify(t);a.writeFileSync("./config.json",o)}s.testCon(t,(function(e,n){e?(console.log(e),o.status(500).json(e)):o.status(200).json(n)}))})),i.get("/configdb",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n);o.status(200).json(t)})),i.post("/savecfgeventos",(async(e,o)=>{let n,t,E=a.readFileSync("./config.json"),r=JSON.parse(E);null===e.body.cod_evento?(n="INSERT INTO CFGEVENTOS(TIPO, DESCRICAO, DIAS, MENSAGEM, CJOPERACAO, STATUS, SQL) VALUES (?,?,?,?,?,?,?)",t=[parseInt(e.body.tipo),e.body.descricao,parseInt(e.body.dias),e.body.mensagem,parseInt(e.body.cjoperacao),e.body.status,e.body.sql]):(n="UPDATE OR INSERT INTO CFGEVENTOS(COD_EVENTO, TIPO, DESCRICAO, DIAS, MENSAGEM, CJOPERACAO, STATUS, SQL) VALUES (?,?,?,?,?,?,?,?) MATCHING (COD_EVENTO)",t=[parseInt(e.body.cod_evento),parseInt(e.body.tipo),e.body.descricao,parseInt(e.body.dias),e.body.mensagem,parseInt(e.body.cjoperacao),e.body.status,e.body.sql]),s.executeQuerySL(r,n,t,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.post("/cfgeventos",(async(e,o)=>{let n,t,E=a.readFileSync("./config.json"),r=JSON.parse(E);n=" UPDATE CFGEVENTOS C SET MANUAL = ? WHERE C.COD_EVENTO = ?",t=[e.body.manual,parseInt(e.body.cod_evento)],s.executeQuerySL(r," UPDATE CFGEVENTOS C SET MANUAL = ? WHERE C.COD_EVENTO = ?",t,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/eventos",((e,o)=>{let n,t=a.readFileSync("./config.json"),E=JSON.parse(t),r="SELECT E.*, E.ID_CLIENTE AS IDCLIENTE, C.DESCRICAO AS EVENTO, CAST(E.MENSAGEM AS VARCHAR(5000)) AS MENSAGEM, (select c.msgunica from cfgall c) as msgunica FROM EVENTOS E JOIN CFGEVENTOS C ON C.COD_EVENTO = E.COD_EVENTO WHERE E.DATA = ? AND E.STATUS <> 'Excecao' AND E.STATUS <> 'Duplicado ' ",c=new Date;c.setHours(0,0,0,0),n=e.query.data?[e.query.data]:[c],e.query.filtro&&e.query.filtro.length>0&&(r+=" AND E.STATUS IN (",e.query.filtro.map((e=>{"true"===e.status&&(r+=`'${e.nome}', `)})),r+="'')"),r+=" ORDER BY E.STATUS,E.ID_CLIENTE,E.VENCIMENTO ",s.executeQuerySL(E,r,n,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.post("/eventos",(async(e,o)=>{let n,t,E=a.readFileSync("./config.json"),r=JSON.parse(E);n="UPDATE EVENTOS SET NOME = ?, TELEFONE1 = ?, TELEFONE2 = ?, MENSAGEM = ?, DATA = ?, STATUS = ?, LOG = ?, PRIMEIRONOME = ?, IDADE = ?, VALOR = ?, VENCIMENTO = ?, NUMDOC = ?, CODIGODEBARRASBOLETO = ?, RAZAOSOCIAL = ? WHERE ID = ?",t=[e.body.nome,e.body.telefone1,e.body.telefone2,e.body.mensagem,e.body.data,e.body.status,e.body.log,e.body.primeironome,e.body.idade,e.body.valor,e.body.vencimento,e.body.numdoc,e.body.codigodebarrasboleto,e.body.razaosocial,e.body.id],s.executeQuerySL(r,"UPDATE EVENTOS SET NOME = ?, TELEFONE1 = ?, TELEFONE2 = ?, MENSAGEM = ?, DATA = ?, STATUS = ?, LOG = ?, PRIMEIRONOME = ?, IDADE = ?, VALOR = ?, VENCIMENTO = ?, NUMDOC = ?, CODIGODEBARRASBOLETO = ?, RAZAOSOCIAL = ? WHERE ID = ?",t,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.delete("/eventos",(async(e,o)=>{let n,t=a.readFileSync("./config.json"),E=JSON.parse(t);n=" delete from eventos e where e.cod_evento in (select c.cod_evento from cfgeventos c where c.tipo = 2) and e.data = current_date and e.status = 'Pendente' ",s.executeQuerySL(E," delete from eventos e where e.cod_evento in (select c.cod_evento from cfgeventos c where c.tipo = 2) and e.data = current_date and e.status = 'Pendente' ",[],(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.patch("/atualizaeventos",(function(e,o){let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.body.mensagem,e.body.status,e.body.log,parseInt(e.body.id)];s.executeQuerySL(t,"UPDATE EVENTOS SET MENSAGEM = ?, STATUS = ?, LOG = ? WHERE ID = ?",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json({result:n})}))})),i.post("/enviaeventos",(function(e,o){lista=[],e.body.length>0?lista=e.body:o.status(204).json("Lista vazia"),r.enviaEventos(lista,(function(e,n){e?o.status(204).json(e):o.status(200).json(n)}))})),i.post("/enviapromocao",(function(e,o){r.enviaPromocao(e.body,(function(e,n){e?o.status(204).json(e):o.status(200).json(n)}))})),i.get("/allcfgeventos",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[parseInt(e.body.cod_evento),e.body.descricao,e.body.status,e.body.mensagem];s.executeQuerySL(t,"SELECT C.*, CAST(C.MENSAGEM AS VARCHAR(1000)) AS MENSAGEM FROM CFGEVENTOS C ORDER BY C.COD_EVENTO",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/cfgeventos1",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[parseInt(e.body.cod_evento),e.body.descricao,e.body.status,e.body.mensagem];s.executeQuerySL(t,"SELECT C.*, CAST(C.MENSAGEM AS VARCHAR(1000)) AS MENSAGEM FROM CFGEVENTOS C WHERE C.TIPO = 1 ORDER BY C.COD_EVENTO",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/cfgeventos2",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[parseInt(e.body.cod_evento),e.body.descricao,e.body.status,e.body.mensagem];s.executeQuerySL(t,"SELECT C.*, CAST(C.MENSAGEM AS VARCHAR(1000)) AS MENSAGEM FROM CFGEVENTOS C WHERE C.TIPO = 2 ORDER BY C.DIAS",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/cfgeventos3",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[parseInt(e.body.cod_evento),e.body.descricao,e.body.status,e.body.mensagem];s.executeQuerySL(t,"SELECT C.*, CAST(C.MENSAGEM AS VARCHAR(1000)) AS MENSAGEM, CAST(C.SQL AS VARCHAR(2000)) AS SQL FROM CFGEVENTOS C WHERE C.TIPO = 3 ORDER BY C.COD_EVENTO",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.delete("/cfgeventos",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[parseInt(e.query.cod_evento)];s.executeQuerySL(t,"DELETE FROM CFGEVENTOS WHERE COD_EVENTO = ?",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/carregaeventos",(async(e,o)=>{r.carregaEventos().then((e=>o.status(200).json(e)))})),i.get("/vendedoreserp",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n);s.executeQueryERP(t," SELECT V.VENDEDOR, cast(v.nome as varchar(100) character set ISO8859_1) AS NOME FROM VENDEDOR V where tipo = 0 and INATIVO = 'N' ORDER BY V.NOME ",[],(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/categoriaserp",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n);s.executeQueryERP(t," select CATEGORIA,cast(nome as varchar(100) character set ISO8859_1) AS NOME from categoria ",[],(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/situacoeserp",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n);s.executeQueryERP(t," SELECT situacao, cast(nome as varchar(100) character set ISO8859_1) AS NOME FROM SITUACAO WHERE TIPO=0 ",[],(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/clienteserp",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E="\n    SELECT DISTINCT C.CLIENTE,cast(c.nome as varchar(100) character set ISO8859_1) AS NOME,CC.RAZAO as RAZAOSOCIAL,CE.TELEFONE as TELEFONE1, (select first(1) ce1.telefone from cli_ende ce1 where ce1.cliente = c.cliente and ce1.tipo = 'T')as telefone2, CID.NOME AS CIDADE, cast(B.NOME as varchar(100) character set ISO8859_1) AS BAIRRO,(select cat.nome from categoria cat where cat.categoria=C.categoria) as Categoria,C.CONVENIO,C.SITUACAO,C.VENDEDOR,'Pendente' as status\n     FROM CLIENTE C\n     LEFT JOIN SITUACAO S ON C.SITUACAO = S.SITUACAO \n     LEFT JOIN CONVENIO CV ON C.CONVENIO = CV.CONVENIO \n     LEFT JOIN CLI_ENDE CE ON C.CLIENTE = CE.CLIENTE AND CE.TIPO = 'R'\n     LEFT JOIN CLI_COMP CC ON CC.CLIENTE = C.CLIENTE\n     LEFT JOIN BAIRRO B ON CE.BAIRRO = B.BAIRRO\n     LEFT JOIN CIDADE CID ON CE.CIDADE = CID.CIDADE\n     WHERE C.CLIENTE IS NOT NULL\n     AND (c.flg_inativo is null or c.flg_inativo = '0')\n    ",r=[];e.query.vendedor&&(E+=" AND C.VENDEDOR = ? ",r.push(parseFloat(e.query.vendedor))),e.query.categoria&&(E+=" AND C.CATEGORIA = ? ",r.push(e.query.categoria)),e.query.situacao&&(E+=" AND C.SITUACAO = ? ",r.push(e.query.situacao)),e.query.personalizado&&"1"===e.query.personalizado&&(E+=" AND C.CLIENTE IN (select distinct v.cliente from venda v where v.datdoc >= CURRENT_DATE - 90) "),s.executeQueryERP(t,E,r,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/eventosexcecao",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.query.cod_evento];s.executeQuerySL(t," SELECT * FROM EVENTOS_EXCECAO WHERE COD_EVENTO = ?",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.post("/eventosexcecao",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.body.cod_evento,e.body.id_cliente];s.executeQuerySL(t,"UPDATE OR INSERT INTO EVENTOS_EXCECAO(COD_EVENTO, ID_CLIENTE) VALUES (?,?) MATCHING (COD_EVENTO, ID_CLIENTE)",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.delete("/eventosExcecao",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.query.cod_evento,e.query.id_cliente];s.executeQuerySL(t,"DELETE FROM EVENTOS_EXCECAO WHERE COD_EVENTO = ? AND ID_CLIENTE = ?",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/promocaoerp",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n);s.executeQueryERP(t,"SELECT T.COD_PROMOCAO, cast(T.NOM_PROMOCAO as varchar(100) character set ISO8859_1) AS NOM_PROMOCAO FROM TAB_PROMOCAO T WHERE T.dat_final >= CURRENT_DATE",[],(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/promocaoapi",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[parseFloat(e.query.id_promocao)];s.executeQuerySL(t,"SELECT P.*, CAST(MENSAGEM AS VARCHAR(1000)) AS MENSAGEM, CAST(LEGENDA AS VARCHAR(1000)) AS LEGENDA FROM PROMOCAO P WHERE P.ID_PROMOCAO = ?",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/promocaologs",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.query.id_promocao];s.executeQuerySL(t," SELECT * FROM PROMOCAO_LOGS P WHERE P.ID_PROMOCAO = ? AND P.DATA = CURRENT_DATE ",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.post("/promocaologs",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.body.data,e.body.id_promocao,e.body.id_cliente,e.body.status];s.executeQuerySL(t," UPDATE OR INSERT INTO PROMOCAO_LOGS(DATA,ID_PROMOCAO,ID_CLIENTE,STATUS) VALUES (?,?,?,?) MATCHING (DATA,ID_PROMOCAO,ID_CLIENTE,STATUS) ",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.post("/promocaoapi",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.body.id_promocao,e.body.mensagem,e.body.legenda];s.executeQuerySL(t,"UPDATE OR INSERT INTO PROMOCAO(ID_PROMOCAO,MENSAGEM, LEGENDA) VALUES (?,?,?) MATCHING (ID_PROMOCAO)",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/produtospromocaoerp",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.query.cod_promocao];s.executeQueryERP(t,"SELECT \n     P.produto as codigoproduto\n     , cast(P.nome as varchar(100) character set ISO8859_1) AS nomeproduto \n     , E.vrvend as valororiginal \n     , T.vlr_vend_promocao as valorpromocional \n     , T.num_per_promocao as percentualdesconto \n     , (select c.diretorio_padrao from cfg_geral c) || 'Imagens\\Produtos\\' || PF.foto as caminhofoto \n     , PF.foto as nomefoto\n     , PF.base64 \n      FROM TAB_PROMOCAO_ITEM T \n      JOIN PRODUTO P ON P.produto = t.cod_produto \n      JOIN ESTOQUE E ON E.deposito = t.cod_deposito and e.produto = p.produto \n      LEFT JOIN PRODUTOFOTO PF ON PF.produto = P.produto \n      WHERE T.cod_promocao = ?\n    ",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/mapa",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n);s.executeQueryERP(t,"SELECT * FROM MAPA ORDER BY MAPA DESC",[],(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))})),i.get("/mapavendas",((e,o)=>{let n=a.readFileSync("./config.json"),t=JSON.parse(n),E=[e.query.mapa];s.executeQueryERP(t," SELECT V.VENDA,  V.MAPA,  V.CLIENTE,  C.NOME,  V.NRODOC,  V.DATDOC,  VDD.NOME AS VENDEDOR,  V.TOTALDOC,  CE.endereco || ' ' || CE.nro || ' ' || B.NOME || ' ' || CD.NOME || ',' || CD.UF  as ENDERECO  FROM VENDA V  LEFT JOIN CLIENTE C ON V.CLIENTE = C.CLIENTE  LEFT JOIN CLI_ENDE CE ON V.CLIENTE = CE.CLIENTE AND CE.TIPO = 'R'  LEFT JOIN BAIRRO B ON B.BAIRRO = CE.BAIRRO  LEFT JOIN CIDADE CD ON CE.CIDADE = CD.CIDADE  LEFT JOIN VENDEDOR VDD ON VDD.VENDEDOR = V.VENDEDOR  WHERE V.MAPA = ?  AND V.CANCELADO IS NULL  ORDER BY V.NRODOC, V.CLIENTE, V.DATDOC ",E,(function(e,n){e?(o.status(500).send(e+""),console.log(e)):o.status(200).json(n)}))}));let O=a.readFileSync("./config.json"),l=JSON.parse(O);i.listen(l.portApi,(()=>{console.log(">>> WebApi started <<<")}))})()})();